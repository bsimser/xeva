<?xml version="1.0"?>
<project name="XEVA Framework Build"
			default="build"
			basedir=".">

  <property name="project-name" value="XEVA Framework" overwrite="false" />
  <property name="project-config" value="Debug" />
  <property name="version-number" value="0.2.0.0" />
  <property name="build-package-dir" value="..\package\" overwrite="false" />
  <property name="build-source-dir" value="..\..\src" overwrite="false" />
  <property name="build-lib-dir" value="..\..\lib" overwrite="false" />
  <property name="build-package-dir" value="..\out\package" overwrite="false" />
  <property name="tools-dir" value="..\..\tools" />
  <property name="build-verbosity" value="Minimal" />

  <loadtasks>
    <fileset>
      <include name="${tools-dir}\ncoverexplorer-nant-tasks-1.4\NCoverExplorer.NAntTasks.dll" />
      <include name="${tools-dir}\nantcontrib-0.85\NAnt.Contrib.Tasks.dll" />
    </fileset>
  </loadtasks>

  <target name="build">
    <call target="clean" />
    <call target="compile" />
    <call target="compile.samples" />
    <call target="package" />
    <call target="specs" />
  </target>
  
  <target name="clean">
    <delete dir="${build-package-dir}" failonerror="false" />
  </target>

  <target name="compile.samples">

    <msbuild project="${build-source-dir}\Samples\BankTeller\BankTeller.UI.Smart\BankTeller.UI.Smart.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Samples\BankTeller\BankTeller.UI.Smart.Specs\BankTeller.UI.Smart.Specs.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

  </target>

  <target name="compile">

    <msbuild project="${build-source-dir}\Framework.Specs\Specs.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Shared\Shared.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Shared.Specs\Shared.Specs.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Model\Model.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Model.Specs\Model.Specs.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Store\Store.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Store.Specs\Store.Specs.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Services\Services.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.Services.Specs\Services.Specs.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.UI.Smart\UI.Smart.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

    <msbuild project="${build-source-dir}\Framework.UI.Smart.Specs\UI.Smart.Specs.csproj" verbosity="${build-verbosity}">
      <property name="Configuration" value="${project-config}"/>
    </msbuild>

  </target>

  <target name="package">

    <mkdir dir="${build-package-dir}" failonerror="false" />

    <copy todir="${build-package-dir}">
      <fileset>
        <include name="${build-lib-dir}/**/*.dll" />
        <include name="${build-lib-dir}/**/*.pdb" />
      </fileset>
    </copy>

    <copy file="${build-source-dir}\Framework.Specs\bin\${project-config}\XF.Specs.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Specs\bin\${project-config}\XF.Specs.pdb" todir="${build-package-dir}"/>

    <copy file="${build-source-dir}\Framework.Shared\bin\${project-config}\XF.Shared.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Shared\bin\${project-config}\XF.Shared.pdb" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Shared.Specs\bin\${project-config}\XF.Shared.Specs.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Shared.Specs\bin\${project-config}\XF.Shared.Specs.pdb" todir="${build-package-dir}"/>

    <copy file="${build-source-dir}\Framework.Model\bin\${project-config}\XF.Model.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Model\bin\${project-config}\XF.Model.pdb" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Model.Specs\bin\${project-config}\XF.Model.Specs.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Model.Specs\bin\${project-config}\XF.Model.Specs.pdb" todir="${build-package-dir}"/>

    <copy file="${build-source-dir}\Framework.Store\bin\${project-config}\XF.Store.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Store\bin\${project-config}\XF.Store.pdb" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Store.Specs\bin\${project-config}\XF.Store.Specs.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Store.Specs\bin\${project-config}\XF.Store.Specs.pdb" todir="${build-package-dir}"/>

    <copy file="${build-source-dir}\Framework.Services\bin\${project-config}\XF.Services.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Services\bin\${project-config}\XF.Services.pdb" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Services.Specs\bin\${project-config}\XF.Services.Specs.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.Services.Specs\bin\${project-config}\XF.Services.Specs.pdb" todir="${build-package-dir}"/>

    <copy file="${build-source-dir}\Framework.UI.Smart\bin\${project-config}\XF.UI.Smart.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.UI.Smart\bin\${project-config}\XF.UI.Smart.pdb" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.UI.Smart.Specs\bin\${project-config}\XF.UI.Smart.Specs.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Framework.UI.Smart.Specs\bin\${project-config}\XF.UI.Smart.Specs.pdb" todir="${build-package-dir}"/>

    <copy file="${build-source-dir}\Samples\BankTeller\BankTeller.UI.Smart\bin\${project-config}\BankTeller.UI.Smart.exe" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Samples\BankTeller\BankTeller.UI.Smart\bin\${project-config}\BankTeller.UI.Smart.pdb" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Samples\BankTeller\BankTeller.UI.Smart.Specs\bin\${project-config}\BankTeller.UI.Smart.Specs.dll" todir="${build-package-dir}"/>
    <copy file="${build-source-dir}\Samples\BankTeller\BankTeller.UI.Smart.Specs\bin\${project-config}\BankTeller.UI.Smart.Specs.pdb" todir="${build-package-dir}"/>
 
  </target>

  <target name="specs">
    <nunit2 verbose="true" haltonfailure="false" failonerror="true">
      <formatter type="Plain" />
      <test haltonfailure="false">
        <assemblies>
          <include name="${build-package-dir}/**.Specs.dll" />
        </assemblies>
      </test>
    </nunit2>
  </target>

</project>